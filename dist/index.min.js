'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _axios=require('axios'),_axios2=_interopRequireDefault(_axios);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var is_debug=!1;/ypdebug/.test(navigator.userAgent.toLowerCase())&&(is_debug=!0);function install(a,b){var c=Object.assign({method:'$http'},b);c.baseURL&&(_axios2.default.default.baseURL=c.baseURL),a.prototype[c.method]={};var d=function(h,i,j){return new Promise(function(k,l){_axios2.default.post(j&&j.path||c.path,{method:h,biz_content:i}).then(function(m){is_debug&&console.group(),is_debug&&console.log('%c POST %c '+h+' ','background: #222; color: #bada55','background: green; color: white'),is_debug&&console.log('%c PARAMS ','background: #222; color: #fff',i),is_debug&&console.log('%c RESPONSE ','background: #222; color: yellow',m),is_debug&&console.groupEnd(),k(m)}).catch(function(m,n){is_debug&&console.group(),is_debug&&console.error('%c POST %c '+h+' ','background: #222; color: #bada55','background: green; color: white'),is_debug&&console.error('%c PARAMS ','background: #222; color: #fff',i),is_debug&&console.error('%c RESPONSE ','background: #222; color: yellow',n),is_debug&&console.groupEnd(),l(m,n)})})},e=function(h,i,j){return new Promise(function(k,l){_axios2.default.get(j&&j.path||c.path,{params:{method:h,biz_content:i}}).then(function(m){is_debug&&console.group(),is_debug&&console.log('%c GET %c '+h+' ','background: #222; color: #bada55','background: green; color: white'),is_debug&&console.log('%c PARAMS ','background: #222; color: #fff',i),is_debug&&console.log('%c RESPONSE ','background: #222; color: yellow',m),is_debug&&console.groupEnd(),k(m)}).catch(function(m,n){iis_debug&&console.group(),is_debug&&console.error('%c GET %c '+h+' ','background: #222; color: #bada55','background: green; color: white'),is_debug&&console.error('%c PARAMS ','background: #222; color: #fff',i),is_debug&&console.error('%c RESPONSE ','background: #222; color: yellow',n),is_debug&&console.groupEnd(),l(m,n)})})},f=function(h,i){return new Promise(function(j,k){is_debug&&console.log('%c UPLOAD ','background: #222; color: #bada55',h);try{var l,m;i&&i.type&&'form-data'!=i.type||(l={header:{'Content-Type':'multipart/form-data'}},m=new FormData,Object.keys(h).map(function(n){'[object Array]'==Object.prototype.toString.call(h[n])?m.append(n,h[n][0],h[n][1]||''):m.append(n,h[n])})),l=Object.assign(l,i.options),j(_axios2.default.post(i&&i.path||c.path,m,l))}catch(n){is_debug&&console.error('%c UPLOAD ','background: #222; color: #bada55',resp),k(n)}})},g=function(h,i,j){return new Promise(function(k,l){is_debug&&console.log('%c DOWNLOAD %c '+h+' ','background: #222; color: #bada55','background: green; color: white'),is_debug&&console.log('%c PARAMS ','background: #222; color: #fff',i);var m=Object.assign({responseType:'blob'},j&&j.options);_axios2.default.post(j&&j.path||c.path,{method:h,biz_content:i},m).then(function(n){try{parseResponseToJSON(n.data).then(function(o){is_debug&&console.log('%c DOWNLOAD RESPONSE ','background: #222; color: yellow',o),k(Object.assign(n,{data:o}))}).catch(function(){var r=new Blob([n.data],{type:n.data.type}),p=document.createElement('a'),q=window.URL.createObjectURL(r);p.href=q;var s=decodeURIComponent(n.headers['content-disposition']);s=s.match(/filename\*=UTF-8''\W+\.\w+/);var t;j&&j.filename?t=j.filename:(t=+new Date,s&&(t=s[0].replace('filename*=UTF-8\'\'',''))),p.download=t,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(q),k(n)})}catch(o){is_debug&&console.error('%c DOWNLOAD ','background: #222; color: yellow',o),l(o)}}).catch(function(n){is_debug&&console.error('%c DOWNLOAD ','background: #222; color: yellow',n),l(n)})})};a.prototype[c.method].get=e,a.prototype[c.method].post=d,a.prototype[c.method].upload=f,a.prototype[c.method].download=g,a.prototype.$axios=_axios2.default,a.yphttp={get:e,post:d,upload:f,download:g}}function parseResponseToJSON(a){return new Promise(function(b,c){try{var d=new FileReader;d.onload=function(){try{var e=JSON.parse(this.result);0!=e.error_code&&b(e)}catch(f){c(f)}},d.readAsText(a)}catch(e){c(e)}})}exports.default=install,'undefined'!=typeof window&&window.Vue&&(window.Vue.use(install),install.installed&&(install.installed=!1));