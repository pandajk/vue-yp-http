'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _axios=require('axios');var _axios2=_interopRequireDefault(_axios);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var is_debug=false;if(/ypdebug/.test(navigator.userAgent.toLowerCase())){is_debug=true}function install(Vue,options){var _opt=Object.assign({method:'$http'},options);_opt.baseURL&&(_axios2.default.default.baseURL=_opt.baseURL);Vue.prototype[_opt.method]={};var post=function post(method,params,options){return new Promise(function(resolve,reject){_axios2.default.post(options&&options.path||_opt.path,{method:method,biz_content:params}).then(function(resp){is_debug&&console.group();is_debug&&console.log('%c POST %c '+method+' ','background: #222; color: #bada55','background: green; color: white');is_debug&&console.log('%c PARAMS ','background: #222; color: #fff',params);is_debug&&console.log('%c RESPONSE ','background: #222; color: yellow',resp);is_debug&&console.groupEnd();resolve(resp)}).catch(function(err,resp){is_debug&&console.group();is_debug&&console.error('%c POST %c '+method+' ','background: #222; color: #bada55','background: green; color: white');is_debug&&console.error('%c PARAMS ','background: #222; color: #fff',params);is_debug&&console.error('%c RESPONSE ','background: #222; color: yellow',resp);is_debug&&console.groupEnd();reject(err,resp)})})};var get=function get(method,params,options){return new Promise(function(resolve,reject){_axios2.default.get(options&&options.path||_opt.path,{params:{method:method,biz_content:params}}).then(function(resp){is_debug&&console.group();is_debug&&console.log('%c GET %c '+method+' ','background: #222; color: #bada55','background: green; color: white');is_debug&&console.log('%c PARAMS ','background: #222; color: #fff',params);is_debug&&console.log('%c RESPONSE ','background: #222; color: yellow',resp);is_debug&&console.groupEnd();resolve(resp)}).catch(function(err,resp){iis_debug&&console.group();is_debug&&console.error('%c GET %c '+method+' ','background: #222; color: #bada55','background: green; color: white');is_debug&&console.error('%c PARAMS ','background: #222; color: #fff',params);is_debug&&console.error('%c RESPONSE ','background: #222; color: yellow',resp);is_debug&&console.groupEnd();reject(err,resp)})})};var upload=function upload(params,options){return new Promise(function(resolve,reject){is_debug&&console.log('%c UPLOAD ','background: #222; color: #bada55',params);try{var _options=void 0;var formData=void 0;if(!options||!options.type||options.type=='form-data'){_options={header:{'Content-Type':'multipart/form-data'}};formData=new FormData;Object.keys(params).map(function(key){if(Object.prototype.toString.call(params[key])=='[object Array]'){formData.append(key,params[key][0],params[key][1]||'')}else{formData.append(key,params[key])}})}_options=Object.assign(_options,options.options);resolve(_axios2.default.post(options&&options.path||_opt.path,formData,_options))}catch(err){is_debug&&console.error('%c UPLOAD ','background: #222; color: #bada55',resp);reject(err)}})};var download=function download(method,params,options){return new Promise(function(resolve,reject){is_debug&&console.log('%c DOWNLOAD %c '+method+' ','background: #222; color: #bada55','background: green; color: white');is_debug&&console.log('%c PARAMS ','background: #222; color: #fff',params);var _options=Object.assign({responseType:'blob'},options&&options.options);_axios2.default.post(options&&options.path||_opt.path,{method:method,biz_content:params},_options).then(function(resp){try{parseResponseToJSON(resp.data).then(function(response){is_debug&&console.log('%c DOWNLOAD RESPONSE ','background: #222; color: yellow',response);resolve(Object.assign(resp,{data:response}))}).catch(function(err){var blob=new Blob([resp.data],{type:resp.data.type});var downloadElement=document.createElement('a');var href=window.URL.createObjectURL(blob);downloadElement.href=href;var filename=void 0;if(options&&options.filename){filename=options.filename}else{filename=+new Date;var tmp=decodeURIComponent(resp.headers['content-disposition']);tmp=tmp.match(/filename\*?=(UTF-8'')?(\S*|\s*)*\.\w+/);if(tmp){filename=tmp[0].replace(/filename\*?=(UTF-8'')?/,'')}}downloadElement.download=filename;document.body.appendChild(downloadElement);downloadElement.click();document.body.removeChild(downloadElement);window.URL.revokeObjectURL(href);resolve(resp)})}catch(err){is_debug&&console.error('%c DOWNLOAD ','background: #222; color: yellow',err);reject(err)}}).catch(function(err){is_debug&&console.error('%c DOWNLOAD ','background: #222; color: yellow',err);reject(err)})})};Vue.prototype[_opt.method].get=get;Vue.prototype[_opt.method].post=post;Vue.prototype[_opt.method].upload=upload;Vue.prototype[_opt.method].download=download;Vue.prototype.$axios=_axios2.default;Vue.yphttp={get:get,post:post,upload:upload,download:download}}function parseResponseToJSON(data){return new Promise(function(resolve,reject){try{var fr=new FileReader;fr.onload=function(){try{var tmpResp=JSON.parse(this.result);if(tmpResp.error_code!=0){resolve(tmpResp)}}catch(err){reject(err)}};fr.readAsText(data)}catch(err){reject(err)}})}exports.default=install;if(typeof window!=='undefined'&&window.Vue){window.Vue.use(install);if(install.installed){install.installed=false}}
